---

  - name: Download HBase archive
    get_url:
      url: "{{ hbase_archive_url }}"
      dest: "{{ script_path }}"
      mode: 0600
      checksum: sha256:{{ hbase_archive_file_checksum256 }}
    run_once: true
    delegate_to: localhost

  - name: Copy archive
    copy:
      src: "{{ script_path }}/{{ hbase_archive }}"
      dest: "/tmp"
      remote_src: yes

  - name: Extract archive
    ansible.builtin.unarchive:
      src: "/tmp/{{ hbase_archive }}"
      dest: "/tmp"
      remote_src: yes

  - name: Write config template
    ansible.builtin.command:
      cmd: "{{ script_path }}/hbase/files/hbase-config.sh"
    delegate_to: localhost

  - name: Create hbase-site.xml
    template: src={{ script_path }}/{{ hbase_config_path }}/hbase-site.xml.j2 dest={{ script_path }}/{{ hbase_config_path }}/hbase-site.xml mode=0700
