---

  - name: Download Hadoop archive
    get_url:
      url: "{{ hadoop_archive_url }}"
      dest: "{{ script_path }}"
      mode: 0600
      checksum: sha256:{{ hadoop_archive_file_checksum256 }}
    run_once: true
    delegate_to: localhost

  - name: Copy archive
    copy:
      src: "{{ script_path }}/{{ hadoop_archive }}"
      dest: "/tmp"
      remote_src: yes

  - name: Extract archive
    ansible.builtin.unarchive:
      src: "/tmp/{{ hadoop_archive }}"
      dest: "/tmp"
      remote_src: yes

  - name: Write config template
    ansible.builtin.command:
      cmd: "{{ script_path }}/hdfs/files/hadoop-config.sh"
    delegate_to: localhost

  - name: Create core-site.xml
    template: src={{ hdfs_config_path}}/core-site.xml.j2 dest={{ hdfs_config_path}}/core-site.xml mode=0700

  - name: Create hdfs-site.xml
    template: src={{ hdfs_config_path}}/hdfs-site.xml.j2 dest={{ hdfs_config_path}}/hdfs-site.xml mode=0700

  - name: Create mapred-site.xml
    template: src={{ hdfs_config_path}}/core-site.xml.j2 dest={{ hdfs_config_path}}/mapred-site.xml mode=0700
